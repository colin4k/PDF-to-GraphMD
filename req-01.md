## **技术需求规格说明书：自动化知识图谱构建系统**

**版本:** 1.0
**日期:** 2025年6月27日
**项目代号:** Project Obsidian Scholar

### **1.0 系统概述**

本文档详细定义了“自动化知识图谱构建系统”（以下简称“系统”）的功能性与非功能性需求。该系统的核心目标是将非结构化的 PDF 电子书文档，通过多阶段处理管道，转化为一个结构化的、基于链接的个人知识库。最终产出物为一个与 Obsidian 笔记软件完全兼容的知识网络，其中每个知识点为一个独立的 Markdown 文件，知识点之间的关系通过 `[[维基链接]]` 语法表示 [1, 2]。

### **2.0 总体架构与流程需求**

*   **REQ-2.1 (四阶段管道):** 系统必须实现一个端到端的四阶段处理流程：
    1.  **摄取与解析 (Ingestion & Parsing):** 从源 PDF 文件中提取高保真度的结构化内容。
    2.  **知识提取 (Knowledge Extraction):** 从解析后的文本中识别实体与关系。
    3.  **图谱构建与规范化 (Graph Construction & Normalization):** 整合提取的信息并消除歧义。
    4.  **合成与输出 (Synthesis & Output):** 生成最终的、相互链接的 Markdown 文件集。
*   **REQ-2.2 (技术路径选择):** 系统必须支持两种可配置的知识提取技术路径，允许用户根据需求选择：
    *   **路径 A:** 基于大型语言模型（LLM）的提取方法 [3, 4, 5]。
    *   **路径 B:** 基于专门化、可训练的自然语言处理（NLP）模型的方法 [6, 7, 8, 9]。

### **3.0 功能性需求 (FR)**

#### **FR-1: 摄取与解析模块 (Ingestion & Parsing)**

*   **FR-1.1 (核心工具):** 系统必须集成并使用 **MinerU** 开源工具作为其唯一的 PDF 解析引擎 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]。
*   **FR-1.2 (输入格式):** 系统必须能接受单个或批量 `.pdf` 文件作为输入。
*   **FR-1.3 (内容提取能力):** MinerU 组件必须具备以下高保真提取能力：
    *   **FR-1.3.1 (文本与结构):** 提取所有文本内容，并保留原始文档的逻辑结构，包括各级标题、段落、列表和多栏布局 [12, 13, 18, 19]。
    *   **FR-1.3.2 (表格提取):** 自动识别文档中的表格，并将其转换为结构化的 Markdown 或 HTML 格式 [1, 12, 18, 22]。
    *   **FR-1.3.3 (公式提取):** 自动识别文档中的数学公式（行内和块级），并将其转换为 LaTeX 格式 [1, 12, 18, 22]。
    *   **FR-1.3.4 (图像提取):** 提取文档中的图像及其关联的图注文字 [1, 8, 18, 23]。
    *   **FR-1.3.5 (OCR 支持):** 必须能自动检测扫描版或文本乱码的 PDF，并调用其内置的 OCR 引擎进行文本识别 [1, 12, 18, 22]。
*   **FR-1.4 (输出格式):** 解析模块必须能生成两种格式的输出，以供后续模块使用：
    *   **FR-1.4.1 (Markdown 输出):** 生成一个保留了文档层级和复杂元素（表格、公式）的结构化 Markdown 文件。
    *   **FR-1.4.2 (JSON 输出):** 生成一个详细的 JSON 文件，其中包含按阅读顺序列出的内容块，并附带每个块的元数据（如页面坐标）[8, 12, 18, 22]。
*   **FR-1.5 (API 控制):** 必须通过 MinerU 的 Python API 实现该模块，以支持批量处理和无缝集成到自动化工作流中 [1, 24, 17, 18]。

#### **FR-2: 知识提取模块 (Knowledge Extraction)**

*   **FR-2.1 (核心任务):** 本模块的核心任务是从解析后的文本中提取知识图谱三元组（`主语-谓语-宾语`）[25, 26]。
    *   **FR-2.1.1 (实体提取):** 执行命名实体识别（NER）以识别知识图谱的节点（Nodes）[27, 28, 29, 25]。
    *   **FR-2.1.2 (关系提取):** 执行关系提取（RE）以识别实体间的联系，作为知识图谱的边（Edges）[4, 30, 31, 32, 33, 34]。
*   **FR-2.2 (LLM 路径实现 - 路径 A):**
    *   **FR-2.2.1 (提示工程):** 必须实现一个可配置的提示模板系统，该系统应支持：系统角色定义、本体（允许的实体/关系类型）声明、少样本示例注入以及思维链/提示链逻辑 [35, 7, 36, 26, 37, 38, 18, 39, 40]。
    *   **FR-2.2.2 (强制 JSON 输出):** 必须采用技术手段确保 LLM 的输出是严格符合预定义 Schema 的有效 JSON。可选实现包括：模型原生 JSON 模式、函数/工具调用（推荐使用 Pydantic 模型定义 Schema），或使用 `Outlines` 等第三方库 [41, 42, 9, 23, 43]。
*   **FR-2.3 (专门化 NLP 路径实现 - 路径 B):**
    *   **FR-2.3.1 (spaCy NER):** 必须集成 `spaCy` 库。系统需支持使用其预训练模型进行通用实体识别，并提供接口和流程来训练自定义的 NER 模型以适应特定领域 [8, 44, 45, 25, 19, 46]。
    *   **FR-2.3.2 (spaCy RE):** 必须支持基于规则的关系提取，利用 `spaCy` 的 `Matcher` 和依存句法分析功能 [47, 48]。
*   **FR-2.4 (实体规范化):** 系统必须包含一个实体消歧与规范化子模块。该模块负责将文本中对同一实体的不同表述（如“阿尔伯特·爱因斯坦”、“爱因斯坦”、“他”）映射到一个唯一的、规范化的实体 ID [49, 35, 44, 45, 50, 51]。

#### **FR-3: 合成与输出模块 (Synthesis & Output)**

*   **FR-3.1 (文件生成):** 系统必须为知识图谱中的每一个规范化实体节点，生成一个对应的 Markdown 文件 (`.md`) [1, 2]。
*   **FR-3.2 (文件命名约定):** Markdown 文件的名称必须是对应实体的规范化 ID（例如 `相对论.md`）。
*   **FR-3.3 (文件内容结构):** 每个生成的 Markdown 文件必须遵循以下结构：
    1.  **YAML Frontmatter:** 文件顶部用于存放结构化元数据。
    2.  **主标题:** 使用 H1 标题 (`#`) 展示实体名称。
    3.  **定义/描述:** 包含从源文本中提取的关于该实体的定义或描述性段落。
    4.  **关系列表:** 一个专门的区域（如 `## 相关链接`），用于列出该实体的所有出向和入向关系。
*   **FR-3.4 (元数据映射):** 实体的类型和其他属性必须作为键值对写入文件的 YAML Frontmatter 中（例如 `type: Theory`）[1]。
*   **FR-3.5 (关系链接映射):** 对于每一个关系三元组 `(源实体, 关系类型, 目标实体)`，必须在源实体文件的关系列表中，使用 `[[维基链接]]` 语法生成一个链接到目标实体的条目（例如 `- 提出者是 [[阿尔伯特·爱因斯坦]]`）。
*   **FR-3.6 (复杂数据嵌入):** 从 MinerU 提取的表格（HTML/Markdown 格式）和公式（LaTeX 格式）必须被完整地嵌入到其相关实体笔记的正文内容中 [1, 12, 18, 22]。

### **4.0 非功能性需求 (NFR)**

*   **NFR-1 (性能):**
    *   **NFR-1.1 (GPU 加速):** 系统应能检测并利用可用的 NVIDIA GPU (CUDA) 来加速 MinerU 解析和（可选的）本地模型推理任务，以显著缩短处理时间 [24, 17, 52]。
    *   **NFR-1.2 (内存管理):** 系统在进行批量处理时，必须实现有效的内存管理策略，如控制并发、及时清理临时文件，以防止内存溢出 [1, 24]。
*   **NFR-2 (可配置性):**
    *   **NFR-2.1 (本体定义):** 系统的本体（即实体和关系的类型列表）必须是外部可配置的，允许用户在运行前根据不同书籍或领域进行定制 [6, 38, 53]。
    *   **NFR-2.2 (语言支持):** MinerU 解析阶段必须支持语言参数配置（如 `ch` 表示中文），以优化多语言文档的 OCR 和解析准确率 [24]。
*   **NFR-3 (可维护性与稳健性):**
    *   **NFR-3.1 (增量更新):** 系统应支持增量处理模式，能够处理新的 PDF 文档并将其知识融入现有的 Obsidian 库，而无需从头重建整个知识库。
    *   **NFR-3.2 (错误处理):** 整个自动化流程的每个阶段都必须包含健全的 `try-except` 错误处理机制和详细的日志记录功能，以捕获并报告如 PDF 解析失败、LLM API 错误或无效 JSON 输出等问题 [1, 24]。
*   **NFR-4 (可扩展性):**
    *   **NFR-4.1 (图数据库集成):** 系统架构设计应保持模块化，以便未来能够将提取的知识图谱三元组无缝对接到专业的图数据库（如 Neo4j）中，以支持更复杂的图查询与分析 [54, 55, 56, 57]。
    *   **NFR-4.2 (RAG 应用支持):** 最终生成的 Obsidian 库应结构清晰，使其能作为高质量的知识源，用于未来构建检索增强生成（RAG）智能问答系统 [4, 32, 58, 59, 60]。
*   **NFR-5 (可用性):**
    *   **NFR-5.1 (人机协同):** 系统应考虑提供一个审核接口或流程，允许用户审查、修正和验证机器自动提取的知识三元组，以确保最终知识图谱的准确性。

***